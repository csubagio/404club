<html><head><title>404 Club</title><style>body,canvas{padding:0;margin:0}canvas{width:100%;height:100%}</style></head><body><script>let t=document.createElement("canvas");document.body.appendChild(t);let r=t.clientWidth,e=t.clientHeight;t.width=r,t.height=e;let o=t.getContext("webgl"),n=[0,0,1],l=Math.PI,c=t=>l*t/180,a=Math.sin,m=Math.cos,f=Math.acos,u=Math.sqrt;function s(t,r,e,o){return[t[0]*r+e[0]*o,t[1]*r+e[1]*o,t[2]*r+e[2]*o]}function p(t,r){return[t[0]-r[0],t[1]-r[1],t[2]-r[2]]}function h(t){return u(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function g(t){var r=h(t);return r>1e-5?[t[0]/r,t[1]/r,t[2]/r]:[0,0,0]}function v(t,r){return[t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]]}function A(t,r,e){var o=g(p(r,t)),n=g(v(e,o)),l=g(v(o,n));return[n[0],n[1],n[2],0,l[0],l[1],l[2],0,o[0],o[1],o[2],0,t[0],t[1],t[2],1]}function d(t){return[t[12],t[13],t[14]]}function F(t,r){let e=[];for(y=0;y<4;++y)for(x=0;x<4;++x)for(e[4*y+x]=0,i=0;i<4;++i)e[4*y+x]+=r[4*y+i]*t[4*i+x];return e}function T(t,r,e){return[1,0,0,0,0,1,0,0,0,0,1,0,t,r,e,1]}function w(t){var r=m(t),e=a(t);return[1,0,0,0,0,r,e,0,0,-e,r,0,0,0,0,1]}function _(t){var r=m(t),e=a(t);return[r,e,0,0,-e,r,0,0,0,0,1,0,0,0,0,1]}function b(t,r,e){return[t,0,0,0,0,r,0,0,0,0,e,0,0,0,0,1]}function R(t,r,e,o){return F(t,T(r,e,o))}function E(t,r){return F(t,_(r))}function U(t,r,e,o){return F(t,b(r,e,o))}function C(t,r){let e=o.createShader(t);if(o.shaderSource(e,r),o.compileShader(e),o.getShaderParameter(e,o.COMPILE_STATUS))return e}let S=(()=>{let t=((t,r)=>{let e=o.createProgram(),n=t=>o.attachShader(e,t);if(n(t),n(r),o.linkProgram(e),o.getProgramParameter(e,o.LINK_STATUS))return e})(C(o.VERTEX_SHADER,"attribute vec3 pos;\nattribute vec3 nrm;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 world;\nvarying vec3 vnrm;\nvoid main() {\n  vnrm = (world * vec4( nrm.xyz, 0 )).xyz;\n  gl_Position = proj * view * world * vec4( pos.xyz, 1 );\n}"),C(o.FRAGMENT_SHADER,"precision mediump float;\nvarying vec3 vnrm;\nuniform vec3 clr;\nvoid main() {\n  gl_FragColor=vec4(0,0,0,1);\n  vec3 nrm = vnrm;\n  vec3 col = clr;\n  if ( !gl_FrontFacing ) {nrm = -nrm;}\n  float i = 0.1;\n  gl_FragColor.rgb += col * vec3(1.0,0.6,0.5) * i;\n  i = max(0.0,dot(normalize(vec3(1,0.2,1)),nrm));\n  gl_FragColor.rgb += col * vec3(1.0,0.6,0.5) * i;\n  i = max(0.0,dot(normalize(vec3(-1,0.2,-0.3)),nrm));\n  gl_FragColor.rgb += col * vec3(0.3,0.4,0.5) * i;\n}\n")),r={};for(let e of["pos","nrm"])r[e]=o.getAttribLocation(t,e);let e={};for(let r of["proj","view","world","clr"])e[r]=o.getUniformLocation(t,r);return{program:t,attributes:r,uniforms:e}})();function L(t){let r=[],e=t.length/3,n=e/3;for(let e=0;e<n;++e){let o=9*e,n=g(v(p(t.slice(o+3,o+6),t.slice(o,o+3)),p(t.slice(o+6,o+9),t.slice(o,o+3))));for(let e=0;e<3;++e)r=r.concat(t.slice(o+3*e,o+3*e+3)),r=r.concat(n)}let l=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,l),o.bufferData(o.ARRAY_BUFFER,new Float32Array(r),o.STATIC_DRAW),{buf:l,cnt:e}}let P=L([0,0,0,0,1,0,1,0,0]),B=[];function M(t,r,e,o){return B.push({geo:t,pos:r||[0,0,0],rot:e||[0,0,0],scl:o||[1,1,1],mtx:T(0,0,0),mtxs:T(0,0,0),prn:null,clr:[1,1,1]}),B.length-1}let D=(()=>{let t=[],r=[],e=(t,e,o)=>r.push([t,e,o]);slice=(t,r)=>{e(-t,-t,r),e(t,-t,r),e(t,t,r),e(-t,t,r)},slice(.1,0),slice(.5,.1),slice(.3,.7),slice(.1,1);let o=(e,o,n,l)=>t=((t,r)=>{let e=e=>t=t.concat(r[e]);return e(0),e(1),e(3),e(1),e(2),e(3),t})(t,[r[e],r[o],r[n],r[l]]),n=(t,r,e,n,l,i,c,a)=>{o(t,r,i,l),o(r,e,c,i),o(e,n,a,c),o(n,t,l,a)};return o(0,1,2,3),n(0,1,2,3,4,5,6,7),n(4,5,6,7,8,9,10,11),n(8,9,10,11,12,13,14,15),o(12,13,14,15),L(t)})(),k=[1,.5,.4];function H(t,r,e,o){let n=M(D,r,o,e);return B[n].prn=t,B[n].clr=k,n}function I(t,r,e,o){let n=B[t],l=B[r],i=d(n.mtx),c=d(B[e].mtx),a=n.scl,m=l.scl,u=a[2],s=m[2],g=h(p(i,c)),v=0;g<.999999*(u+s)&&(v=-f((u*u+g*g-s*s)/(2*u*g))),n.mtx=A(i,c,o),n.mtx=F(n.mtx,w(v)),l.mtx=R(n.mtx,l.pos[0],l.pos[1],l.pos[2]),l.mtx=A(d(l.mtx),c,o),n.mtx=U(n.mtx,a[0],a[1],a[2]),l.mtx=U(l.mtx,m[0],m[1],m[2])}function z(){let t={};return t.a=M(null),t.b=H(t.a,[0,0,6],[2,1,1]),t.c=H(t.b,[0,0,1],[2,1,1]),t.d=H(t.c,[0,0,1],[2,1,2]),t.e=H(t.d,[0,0,2],[1.7,1.5,2]),t.f=H(t.b,[-.5,0,0],[1,1.5,3],[l,0,0]),t.g=H(t.b,[.5,0,0],[1,1.5,3],[l,0,0]),t.h=H(t.f,[0,0,3],[1,1,3]),t.i=H(t.g,[0,0,3],[1,1,3]),t.j=H(t.a,[-.7,0,0],[1,.5,1.5],[c(-95),-.1,0]),t.k=H(t.a,[.7,0,0,0],[1,.5,1.5],[c(-95),.1,0]),t.l=H(t.d,[-1.5,0,2],[1,1,2],[l,0,0]),t.m=H(t.d,[1.5,0,2],[1,1,2],[l,0,0]),t.n=H(t.l,[0,0,2],[.7,.7,2]),t.o=H(t.m,[0,0,2],[.7,.7,2]),t.p=H(t.n,[0,0,2],[1,.5,1],[0,0,l/2]),t.q=H(t.o,[0,0,2],[1,.5,1],[0,0,l/2]),t}let N=z();k=[.4,1,.5];let O=z();mark1=M(P,[0,0,0]),B[mark1].clr=[1,0,0],mark2=M(P,[0,5,0]),B[mark2].clr=[0,1,0];let j=0,Y=new Date,q=[0,0,6],G=[],K=[],V=(t,r)=>o.uniformMatrix4fv(t,!1,r);function W(t,r){r*=2,B[t.b].pos[2]=5.2+.3*a(2*r),B[t.b].rot[2]=.2+.1*a(r+.7),B[t.b].pos[0]=.4*m(r+.3+l/2);let e=-.2*m(r+.7+l/2);B[t.b].rot[1]=e,B[t.c].rot[1]=-e,B[t.j].pos[0]=-1.5,B[t.j].pos[1]=-1.5,B[t.k].pos[0]=1.5,B[t.k].pos[1]=.5,B[t.j].rot[1]=-.5,B[t.k].rot[1]=.3;let o=l+.5+.1*a(2*r-.6);B[t.l].rot[0]=o,B[t.l].rot[2]=.9,B[t.n].rot[0]=c(120),B[t.m].rot[0]=o,B[t.m].rot[2]=-.25,B[t.o].rot[0]=c(120)}function X(t,r){let[e,o,l]=[[(i=B[t.a].mtx)[0],i[4],i[8]],[i[1],i[5],i[9]],[i[2],i[6],i[10]]];var i;let c=s(e,-.3,o,1);I(t.f,t.h,t.j,c),c=s(e,.7,o,1),I(t.g,t.i,t.k,c),B[t.e].mtx=F(F(A(d(B[t.e].mtx),d(B[r.e].mtx),n),w(-1.5707963267948966)),b.apply(null,B[t.e].scl))}let J=requestAnimationFrame;tick=()=>{let t=new Date,i=Math.min(t-Y,100)/1e3;Y=t,j+=i,(t=>{var o,i,a;o=c(45),i=r/e,G=[(a=Math.tan(.5*l-.5*o))/i,0,0,0,0,a,0,0,0,0,1/-99.9*100.1,-1,0,0,-.20020020020020018,0],K=_(t/4),K=R(K,22,4,9);let m=d(K);K=A(m,q,n);for(let t=0;t<3;++t)K[8+t]=-K[8+t]})(j),o.clearColor(0,0,.2,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.viewport(0,0,r,e),o.cullFace(o.FRONT_AND_BACK),o.enable(o.DEPTH_TEST),o.useProgram(S.program),V(S.uniforms.view,(t=>{let r=T(0,0,0);for(let e=0;e<3;++e)for(let o=0;o<3;++o)r[4*e+o]=t[4*o+e];for(let e=0;e<3;++e)for(let o=0;o<3;++o)r[12+e]+=-t[12+o]*r[4*o+e];return r})(K)),V(S.uniforms.proj,G);let f=(t,r)=>{let e=S.attributes[t];o.vertexAttribPointer(e,3,o.FLOAT,!1,24,r),o.enableVertexAttribArray(e)};f("pos",0),f("nrm",12);let u=0;u=1.5*j,B[N.a].pos[1]=-6,B[O.a].pos[1]=6,B[O.a].rot[2]=l,W(N,u),W(O,u);for(let t of B){let r;r=null!=t.prn?R(B[t.prn].mtxs,t.pos[0],t.pos[1],t.pos[2]):T(t.pos[0],t.pos[1],t.pos[2]),r=F(r,w(t.rot[0])),r=F(r,(s=t.rot[1],void 0,void 0,[p=m(s),0,-(h=a(s)),0,0,1,0,0,h,0,p,0,0,0,0,1])),r=E(r,t.rot[2]),t.mtxs=r.slice(),r=U(r,t.scl[0],t.scl[1],t.scl[2]),t.mtx=r}var s,p,h;X(N,O),X(O,N);for(let t of B)t.geo&&(o.bindBuffer(o.ARRAY_BUFFER,t.geo.buf),f("pos",0),f("nrm",12),o.uniform3fv(S.uniforms.clr,t.clr),V(S.uniforms.world,t.mtx),o.drawArrays(o.TRIANGLES,0,t.geo.cnt));J(tick)},J(tick);</script></body></html>